<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mina Graph Explorer</title>
  <link href="https://fonts.googleapis.com/css2?family=Coda&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <meta name="theme-color" content="#000000">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VR50WVP209"></script>
  <link href="./style/style.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sigma@2.4.0/build/sigma.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/graphology@0.26.0/dist/graphology.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata@2.0.0"></script>  
  <link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script type="module" src="./scripts/fcm-init.js"></script>
  <script src="./scripts/script.js"></script>  

  
</head>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js').then(reg => {
        console.log('[PWA] ServiceWorker registered:', reg);

        // D√©tection de mise √† jour
        reg.onupdatefound = () => {
          const newWorker = reg.installing;
          newWorker.onstatechange = () => {
            if (newWorker.state === 'installed') {
              if (navigator.serviceWorker.controller) {
                console.log('[PWA] New version available ‚Äì refresh to update');
                alert("Nouvelle version disponible. Rechargez la page pour mettre √† jour.");
              } else {
                console.log('[PWA] ServiceWorker installed for the first time');
              }
            }
          };
        };
      }).catch(err => {
        console.error('[PWA] ServiceWorker registration failed:', err);
      });
    });
  }


  <!-- Google tag (gtag.js) -->
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-VR50WVP209'); 
</script>  
<body>
  <button id="menu-toggle" title="Toggle Sidebar (S)">‚ò∞</button>
  <div id="app-container">
    <div id="left-sidebar" style="
      width: 280px;
      background: #1e1e1e;
      color: white;
      padding: 20px;
      overflow-y: auto;
      font-family: sans-serif;
      border-right: 1px solid #444;
    "><br/>
      <h2 style="font-size: 16px; margin-bottom: 10px;">Blockchain</h2>
      <label for="blockchain-select">Select Blockchain</label>
      <select id="blockchain-select" style="margin-bottom: 20px;">
        <option value="mina" selected>Mina Protocol</option>
        <option value="ethereum">Ethereum</option>
        <option value="polygon">Polygon</option>
        <option value="bsc">Binance Smart Chain</option>
        <option value="solana">Solana</option>
        <option value="zksync">ZKsync</option>
        <option value="optimism">Optimism</option>
        <option value="arbitrum">Arbitrum</option>
        <option value="cronos">Cronos</option>
        <option value="tezos">Tezos</option>
        <option value="base">Base</option>
      </select>

      <div style="margin-top: 10px;">
        <label for="wipe-select">Wipe graph data:</label>
        <select id="wipe-select">
          <option value="yes" selected>Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <h2 style="font-size: 16px; margin-bottom: 10px;">Fetch Parameters</h2>
      <label>LIMIT<br /><input id="param-limit" type="number" value="80" style="width: 100%; margin-bottom: 10px;"></label>
      <label>FIRST ITERATION LIMIT<br /><input id="param-first-iteration" type="number" value="1000" style="width: 100%; margin-bottom: 10px;"></label>
      <label>RECURSION DEPTH<br /><input id="param-depth" type="number" value="2" style="width: 100%; margin-bottom: 10px;"></label>
      <label>
        START KEY<br />
        <input 
          id="param-base-key" 
          type="text" 
          placeholder="Starting wallet address to explore"
          style="width: 100%; margin-bottom: 10px;"
        >
      </label>      
      
      <!-- TEMPORARILY HIDDEN SECTION -->
      <div style="display: none;">
      <div style="position: relative; margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 4px;">
          API KEY
          <span 
            onclick="document.getElementById('token-help-overlay').style.display = 'block';" 
            title="Click for more info" 
            style="cursor: pointer; margin-left: 5px; vertical-align: middle;"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
            </svg>
          </span>
        </label>

        <div style="font-size: 8px; color: #FF3333; margin-bottom: 6px;">
          TRIAL PERIOD - NO TOKEN REQUIRED
        </div>

        <!-- Input container with relative positioning -->
        <div style="position: relative;">
          <input id="param-api-token" type="password" style="width: 100%; padding-right: 24px; height: 32px; padding: 6px 8px; border-radius: 6px;" />

          <!-- ‚úñ button INSIDE the input -->
          <button 
            id="clear-token-button" 
            title="Clear token for current blockchain" 
            onclick="document.getElementById('param-api-token').value = ''"
            style="
              position: absolute;
              top: 6px;
              right: 6px;
              background: none;
              border: none;
              color: #ccc;
              font-size: 12px;
              cursor: pointer;
              padding: 0;
              line-height: 1;
            "
          >‚úñ</button>
        </div>
      </div>



      <button id="toggle-token-section" style="width: 100%; margin-bottom: 10px; padding: 8px; cursor: pointer; background: #4fc3f7; color: white; border: none; border-radius: 4px;">
      <span id="toggle-token-arrow">‚ñ∏</span> Get new API token
      <span class="info-icon" title="This tool requires a Minataur API Token.&#10;&#10;To get one, send 1 MINA to the Minataur API address:&#10;B62qk3SwELMgRYALi8fiQvpqfBs48m3cqCd7o4d5dJUqEQ6mW9gEySm&#10;and include your email in the memo field.&#10;&#10;Once confirmed, you'll receive your token by email.&#10;Tokens are valid for 3 days. You can request new ones as needed.&#10;&#10;More info: https://minataur.net/api/restful">
      <span style="font-size:18px; color: white; opacity: 1;">‚Ñπ</span>
      </span>
      </button>
      <div id="minataur-token-section" style="display: none; margin-bottom: 20px;">
        <input id="minataur-email" type="email" placeholder="Enter your email to receive your token" style="width: 100%; margin-bottom: 10px;" />
        <button id="connect-auro-btn" style="width: 100%; background: #4caf50; color: white; padding: 8px; border: none; border-radius: 4px;">Request Token (Auro Wallet required)</button>
      </div>
      </div>     
      <hr/>

      <div>
          <label>&nbsp;</label><br />
          <button id="start-graph-btn" style="width: 100%; margin-bottom: 20px; padding: 8px; cursor: pointer; background: #444; color: white; border: none; border-radius: 4px;">Start</button>
      </div>
      <h2 style="font-size: 16px; margin-bottom: 10px;">Graph Parameters</h2>
     
      <label for="layout-algorithm">ALGORITHM</label>
      <select id="layout-algorithm">
        <option value="fr" selected>Fruchterman-Reingold</option>
        <option value="fa">ForceAtlas2</option>
        <option value="ord">OpenOrd</option>
      </select>
      
      <!-- ForceAtlas2-only settings -->
      <div id="forceatlas-settings" style="display: none; margin-top: 10px;">

        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="layout-linlog" />
          LinLog Mode
        </label>
        
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="layout-outbound" />
          Outbound Attraction Dist
        </label>

        <label style="display: flex; align-items: center; gap: 8px;" title="Makes gravity stronger and less dependent on distance">
          <input type="checkbox" id="layout-strong-gravity" />
          Strong Gravity Mode
        </label>

        <label style="display: flex; align-items: center; gap: 8px;" title="Avoids node overlap by enforcing minimum spacing">
          <input type="checkbox" id="layout-prevent-overlap" checked />
          Prevent Node Overlap
        </label>
        <br/>
      </div>      
      
      <div id="openord-settings" style="display: none;">
        <label>Edge Weight Influence <input id="layout-ewi" type="number" min="0" max="2" step="0.1" value="0.0"></label>
        <label>Cooling Factor <input id="layout-cooling" type="number" min="0.5" max="1" step="0.01" value="0.95"></label>
        <label>Attraction Multiplier <input id="layout-attraction" type="number" min="0.01" max="1" step="0.01" value="0.01"></label>
        <label>Repulsion Multiplier <input id="layout-repulsion" type="number" min="0.1" max="10" step="0.1" value="1.0"></label>
        <label>Initial Cluster Count <input id="layout-clusters" type="number" min="1" max="20" step="1" value="5"></label>
      </div>
      
      
      <label>GRAPH LAYOUT ITERATIONS<br /><input id="layout-iterations" type="number" value="5000" style="width: 100%; margin-bottom: 10px;"></label>
      <label>WIDTH<br /><input id="layout-width" type="number" step="100" value="2000" style="width: 100%; margin-bottom: 10px;"></label>
      <label>HEIGHT<br /><input id="layout-height" type="number" step="100" value="2000" style="width: 100%; margin-bottom: 10px;"></label>
      <label>GRAVITY<br /><input id="layout-gravity" type="number" step="0.01" value="0.01" style="width: 100%; margin-bottom: 10px;"></label>
      <label>SCALE<br /><input id="layout-scale" type="number" step="10" value="1000" style="width: 100%; margin-bottom: 10px;"></label>
      <input type="checkbox" id="toggle-labels" checked style="vertical-align: middle;">
      <label for="toggle-labels" style="color:#aaa; display: inline-block; margin-left: 5px; vertical-align: middle;">SHOW LABELS</label><br/><br/>
      <button id="layout-toggle-btn"
        style="width: 100%; margin-bottom: 20px; padding: 8px; cursor: pointer; background: #444; color: white; border: none; border-radius: 4px;">
        Apply Layout (L)
      </button>
      <div id="layout-progress-wrapper" style="margin-top: 20px;">
        <label style="color:#aaa;">Layout progress</label>
        <progress id="layout-progress" value="0" max="100" style="width: 100%;"></progress>
        <div id="layout-progress-text" style="font-size: 13px; color: #aaa; text-align: right; margin-top: 4px;">0%</div>
      </div>
      
      <h2 style="font-size: 16px; margin-bottom: 10px;">Watched / Favorites</h2>
      <button onclick="showWatchedAddressesModal()" style="width: 100%; margin-bottom: 20px; padding: 8px; background: #2fa3d7; color: white; border: none; border-radius: 4px; cursor: pointer;">
        üì© View Watched Addresses
      </button>
      <button onclick="showFavoritesAddressesModal()" style="width: 100%; margin-bottom: 20px; padding: 8px; background: #aa5300; color: white; border: none; border-radius: 4px; cursor: pointer;">
        ‚≠ê View Favorites Addresses
      </button>
      <h2 style="font-size: 16px; margin-bottom: 10px;">Load / Save</h2>
      <button onclick="exportJSON()" style="width: 100%; margin-bottom: 10px; padding: 8px; cursor: pointer; background: #444; color: white; border: none; border-radius: 4px;">EXPORT JSON</button>
      <button onclick="document.getElementById('import-json').click()" style="width: 100%; margin-bottom: 10px; padding: 8px; cursor: pointer; background: #444; color: white; border: none; border-radius: 4px;">IMPORT JSON</button>
      <input type="file" id="import-json" accept=".json" style="display: none;">
      <button onclick="exportPNG()" style="width: 100%; margin-bottom: 10px; padding: 8px; cursor: pointer; background: #444; color: white; border: none; border-radius: 4px;">EXPORT PNG</button>
      <button onclick="demo()" style="width: 100%; margin-bottom: 10px; padding: 8px; cursor: pointer; background: #444; color: white; border: none; border-radius: 4px;">DEMO MODE</button>
      <div style="margin-top: 40px; text-align: center;">
        <a href="#" onclick="document.getElementById('help-overlay').style.display='flex'" style="color: #4fc3f7; text-decoration: underline; font-size: 14px;">How does this work?</a>
      </div>  
      <div style="margin-top: 10px;">
        <div style="display: flex; align-items: center; gap: 6px; font-size: 10px; margin-top: 10px; color: #ccc;">
          <label style="margin: 0;font-size:9px;">Buy me a coffee (or a Lamborghini üòä)</label>
          <span class="info-icon" title="Support this project by sending any amount of MINA via Auro Wallet." style="cursor: help; font-size: 14px; opacity: 1;">
            ‚Ñπ
          </span>
        </div>
        <input id="donation-amount" type="number" min="0.1" step="0.1" placeholder="Amount in MINA" style="width: 100%; margin-bottom: 10px;" />
        <button id="donate-btn" style="width: 100%; background: #dd9800; color: white; padding: 8px; border: none; border-radius: 4px;">
          Donate with Auro Wallet
        </button>
      </div>
    </div>

    <!-- Watched Addresses Modal -->
    <div id="watched-modal" style="
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      z-index: 10000;
      max-height: 80vh;
      overflow-y: auto;
      /* Responsive width */
      width: 90vw;
      max-width: 600px;
      min-width: 280px;
    ">
      <h3>Watched Addresses</h3>
      <div id="watched-list"></div>
      <button onclick="document.getElementById('watched-modal').style.display='none'" style="
        margin-top: 20px;
        background: #f44336;
        border: none;
        color: white;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
      ">Close</button>
    </div>

    <!-- Favorites Addresses Modal -->
    <div id="favorites-modal" style="
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      z-index: 10000;
      max-height: 80vh;
      overflow-y: auto;

      /* Responsive width */
      width: 90vw;
      max-width: 600px;
      min-width: 280px;
    ">
      <h3>Favorites</h3>
      <div id="favorites-list"></div>
      <button onclick="document.getElementById('favorites-modal').style.display='none'" style="
        margin-top: 20px;
        background: #f44336;
        border: none;
        color: white;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
      ">Close</button>
    </div>
    <!-- Make sure the graph container has margin-left to not overlap the sidebar -->
    <div id="main-content">
      <div id="controls">
        <div style="min-width: 200px;display: none;">
          <label style="color:#aaa;">Layout info</label><br />
          <span id="layout-info" style="display:inline-block; min-width: 180px;"></span>
        </div>
        
        <div style="flex: 1; min-width: 100px;display:none;">
          <label for="progress-bar" style="color:#aaa;">Progress</label><br />
          <progress id="progress-bar" value="0" max="100" style="width: 100%;"></progress>
        </div>
        
        <div style="min-width: 60px;display: none;">
          <label style="color:#aaa;">&nbsp;</label><br />
          <span id="progress-text" style="display:none;"></span>
        </div>

        <!-- Floating search input -->
        <div id="searchdiv" class="search-wrapper" style="display: none;">
          <input id="search-input" type="text" placeholder="Search node..." />
          <button id="clear-search">√ó</button>
        </div>

        <button id="search-icon" title="Search" style="background: none; border: none; cursor: pointer;">
          <svg id="search-icon-svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M15.5,14h-0.79l-0.28-0.27c1.01-1.18,1.63-2.71,1.63-4.38
              C16.06,6.47,13.59,4,10.53,4S5,6.47,5,9.53S7.47,15.06,10.53,15.06
              c1.67,0,3.2-0.62,4.38-1.63l0.27,0.28v0.79l4.25,4.25
              c0.41,0.41,1.08,0.41,1.49,0s0.41-1.08,0-1.49L15.5,14z
              M10.53,13.06c-1.95,0-3.53-1.58-3.53-3.53s1.58-3.53,3.53-3.53
              s3.53,1.58,3.53,3.53S12.48,13.06,10.53,13.06z"/>
          </svg>
        </button>


        <div style="display:none;">
          <label>&nbsp;</label><br />
          <button onclick="pause = !pause">Pause/Resume</button>
        </div>

        <!-- üîî Notification icon with badge -->
        <button id="notification-button" title="Notifications" style="background: none; border: none; position: relative; cursor: pointer; margin-right: 8px;">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 22c1.1 0 2-.9 2-2h-4a2 2 0 002 2zm6-6V9a6 6 0 10-12 0v7l-2 2v1h16v-1l-2-2z" fill="white"/>
          </svg>
          <span id="notification-badge" style="
            position: absolute;
            top: -4px;
            right: -0px;
            background: red;
            color: white;
            border-radius: 50%;
            padding: 2px 5px;
            font-size: 10px;
            display: none;
          ">0</span>
        </button>

        <div id="notification-list" style="
          position: absolute;
          top: 36px;
          right: 0;
          background: #222;
          color: white;
          border: 1px solid #555;
          border-radius: 6px;
          padding: 8px;
          display: none;
          min-width: 250px;
          z-index: 999;
          box-shadow: 0 2px 8px rgba(0,0,0,0.5);
          max-height: 300px;
          overflow-y: auto;
          z-index: 1001;
        "></div>


          <button id="theme-toggle-btn" title="Toggle theme" style="background: none; border: none; cursor: pointer;">
            <span id="theme-icon">
              <!-- SVG moon (default dark theme) -->
              <svg viewBox="0 0 24 24" width="24" height="24" style="fill:white;">
                <path fill="white" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/>
              </svg>
            </span>
          </button>



          <button id="fullscreen-toggle" title="Toggle Fullscreen (F)" style="
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
          ">
            ‚õ∂
          </button>
          
          <button id="reset-db-btn" style="
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
          ">
            üßπ
          </button>

        </div>


       <div id="sigma-container"></div>  
       </div>
      </div>
      <!-- SLICER CONTAINER -->
      <div id="date-slicer-container" >
<!--style="
        position: absolute;
        bottom: 60px;
        right: 30px;
        background: rgba(0, 0, 0, 0.85);
        padding: 14px;
        border-radius: 8px;
        color: white;
        font-size: 13px;
        width: 360px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
      "      -->
        <!--<strong style="display: block; margin-bottom: 8px;">Filter by Transaction Date</strong>-->
        
        <div id="slicer-container" style="width: 100%; height: 140px;">
          <canvas id="slicer-chart" style="width: 100%; height: 100%; display: block;"></canvas>    
        </div>

        <div id="slicer-range" style="margin-top: 12px;"></div>  

        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 10px;">
          <span id="slicer-start-label">From: --</span>
          <span id="slicer-end-label">To: --</span>
        </div>
      </div>
  </div>    
  
    <div id="side-panel">
      <button id="close-panel-btn" onclick="hideNodePanel()">&times;</button>
      <div id="node-details"></div>
    </div>
    
    <div id="tooltip"></div>
   
     <!-- Help overlay -->
    <div id="help-overlay">
      <button onclick="document.getElementById('help-overlay').style.display='none'" style="
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        color: white;
        border: 2px solid white;
        font-size: 18px;
        padding: 8px 16px;
        cursor: pointer;
        border-radius: 5px;
      ">CLOSE</button>
      <h1>How does this work?</h1>
        <p style="font-size: 18px; line-height: 1.6;">
          Mina Graph Explorer is a tool that lets you explore the blockchain visually by graphing interactive connections between accounts. It dynamically fetches and displays transactions as nodes and links, helping you uncover relationships and activity across chains.
          Currently supported blockchains include:
          Mina, Ethereum, Polygon, BSC (Binance Smart Chain), Solana, zkSync, Optimism, Arbitrum, Cronos, Base and Tezos.
        </p>

        <h2 style="font-size: 20px; margin-bottom: 12px;">üîß Configuration Parameters:</h2>
        <ul style="font-size: 16px; line-height: 1.8;">
          <li><strong>SELECT BLOCKCHAIN</strong>: Select the blockchain you want for fetch data from.</li>
          <li><strong>WIPE GRAPH DATA</strong>: Wheter you want to fetch new data and add it to your existing graph or start from a new, clean graph.</li>
          <li><strong>LIMIT</strong>: Max number of transactions to fetch per key (after the first).</li>
          <li><strong>FIRST ITERATION LIMIT</strong>: Max transactions for the root key.</li>
          <li><strong>RECURSION DEPTH</strong>: How many levels of linked accounts to explore.</li>
          <li><strong>START KEY</strong>: The public key where exploration begins.</li>
          <li><strong>API TOKEN</strong>: NOT REQUIRED FOR NOW</li>
          <li><strong>LAYOUT PARAMETERS</strong>: Adjust the layout algorithm (iterations, gravity, scale, etc.)</li>
          <li><strong>EXPORT/IMPORT</strong>: Save or load graph JSON, export image.</li>
          <li><strong>LEGEND</strong>: Filter graph edges by transaction type and blockchain.</li>
          <li><strong>SEARCH</strong>: Look up a node by label or key fragment.</li>
        </ul>
        
        <hr style="margin: 30px 0; border: 1px solid #555;" />

        <h2 style="font-size: 20px; margin-bottom: 12px;">‚ö†Ô∏è Important note on graph complexity</h2>
        <p style="font-size: 16px; line-height: 1.6;">
          The size of the graph grows exponentially based on the combination of:
        </p>
        <ul style="font-size: 16px; line-height: 1.8;">
          <li><strong>FIRST ITERATION LIMIT (F)</strong>: Number of transactions fetched for the root key.</li>
          <li><strong>LIMIT (L)</strong>: Max transactions per linked account.</li>
          <li><strong>DEPTH (D)</strong>: How many recursive levels of linked accounts are explored.</li>
        </ul>
        <p style="font-size: 16px; line-height: 1.6;">
          Estimated number of nodes (accounts):<br />
          <code>N ‚âà 1 + F √ó (L<sup>D</sup> ‚Äì 1) / (L ‚Äì 1)</code>
        </p>
        <p style="font-size: 16px; line-height: 1.6;">
          This means the graph can reach tens of thousands of nodes if values are too high.<br />
          It can impact memory, loading time, layout performance, and browser responsiveness.
        </p>

        <p style="font-size: 16px; line-height: 1.6;">
          For a smooth experience, try values like:
        </p>
        <ul style="font-size: 16px; line-height: 1.8;">
          <li><strong>Safe defaults</strong>: F = 100, L = 20, D = 2</li>
          <li><strong>Deeper graph (heavy)</strong>: F = 200, L = 30, D = 3+</li>
          <li><strong>Shallow & fast</strong>: F = 50, L = 10, D = 1</li>
        </ul>
    </div>

     <!-- Get Token Help overlay -->
    <div id="token-help-overlay">
      <button onclick="document.getElementById('token-help-overlay').style.display='none'" style="
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        color: white;
        border: 2px solid white;
        font-size: 18px;
        padding: 8px 16px;
        cursor: pointer;
        border-radius: 5px;
      ">CLOSE</button>
        <h1>üîë How to get your API Token</h1>
        <p style="font-size: 18px; line-height: 1.6;">
          This app needs an API token to fetch transactions from the selected blockchain.<br />
          Here's how to get a token depending on the blockchain you're using:
        </p>

        <hr style="margin: 20px 0; border: 1px solid #555;" />

        <h2 style="color:#4fc3f7">ü™∂ Mina (Minataur)</h2>
        <p style="font-size: 16px; line-height: 1.6;">
          <strong>No token required during the trial period.</strong><br />
          However, once the trial period is over, for authenticated requests, you'll need a minataur token you can obtain by following these steps :
        </p>
        <ol style="font-size: 16px; line-height: 1.8;">
          <li>Head over <a href="https://minataur.net/api/restful" target="_blank" style="color:#4fc3f7">Minataur.net</a></li>
          <li>Follow the instructions to receive your token by email</li>
          <li>Copy your Minataur API token</li>
        </ol>
        <p style="font-size: 16px; line-height: 1.6;">
          You can also send the transaction directly through Mina Graph Explorer by entering the email address where you want to receive your token, and using Auro Wallet to send 1 MINA to the Minataur API service.
          Mina Graph Explorer (and myself) does not take any commission on this transaction !
          The transaction is as safe as it can be.
        </p>       
        <p>
          üìÑ <a href="https://minataur.net/api/restful" target="_blank" style="color:#4fc3f7">Read Minataur API Docs</a>
        </p>

        <hr style="margin: 30px 0; border: 1px solid #555;" />

        <h2 style="color:#4fc3f7">üü£ Polygon (Polygonscan)</h2>
        <ol style="font-size: 16px; line-height: 1.8;">
          <li>Visit <a href="https://polygonscan.com/register" target="_blank" style="color:#4fc3f7">Polygonscan Register</a> and create an account</li>
          <li>Go to your <a href="https://polygonscan.com/myapikey" target="_blank" style="color:#4fc3f7">API Keys page</a></li>
          <li>Click ‚Äú+ Add‚Äù to generate a new API key</li>
          <li>Copy the key and paste it in the ‚ÄúAPI KEY‚Äù field</li>
        </ol>
        <p>
          üìä <strong>Free Tier:</strong> 5 calls/sec, 100,000/day<br />
          üìÑ <a href="https://docs.polygonscan.com/" target="_blank" style="color:#4fc3f7">View Polygonscan API Docs</a>
        </p>

        <hr style="margin: 30px 0; border: 1px solid #555;" />

        <h2 style="color:#4fc3f7">üü° Ethereum (Etherscan)</h2>
        <ol style="font-size: 16px; line-height: 1.8;">
          <li>Visit <a href="https://etherscan.io/register" target="_blank" style="color:#4fc3f7">Etherscan Register</a> and create an account</li>
          <li>Navigate to <a href="https://etherscan.io/myapikey" target="_blank" style="color:#4fc3f7">API Keys</a></li>
          <li>Click ‚ÄúAdd‚Äù to create a new API token</li>
          <li>Use the key in your request field</li>
        </ol>
        <p>
          ‚õΩ <strong>Free Tier:</strong> 5 calls/sec, 100,000/day<br />
          üìÑ <a href="https://docs.etherscan.io/" target="_blank" style="color:#4fc3f7">Check Etherscan API Docs</a>
        </p>

        <hr style="margin: 30px 0; border: 1px solid #555;" />

        <h2 style="color:#4fc3f7">üîµ Binance Smart Chain (BSCScan)</h2>
        <ol style="font-size: 16px; line-height: 1.8;">
          <li>Visit <a href="https://bscscan.com/register" target="_blank" style="color:#4fc3f7">BSCScan Register</a> and create an account</li>
          <li>Navigate to <a href="https://bscscan.com/myapikey" target="_blank" style="color:#4fc3f7">API Keys</a></li>
          <li>Click ‚ÄúAdd‚Äù to create a new API token</li>
          <li>Use the key in your request field</li>
        </ol>
        <p>
          ‚õΩ <strong>Free Tier:</strong> 5 calls/sec, 100,000/day<br />
          üìÑ <a href="https://docs.bscscan.com/" target="_blank" style="color:#4fc3f7">Check BSCScan API Docs</a>
        </p>

        <hr style="margin: 30px 0; border: 1px solid #555;" />

        <h2 style="color:#4fc3f7">üü© Solana (Helius RPC)</h2>
        <ol style="font-size: 16px; line-height: 1.8;">
          <li>Go to <a href="https://www.helius.xyz/" target="_blank" style="color:#4fc3f7">helius.xyz</a> and create a free account</li>
          <li>After logging in, go to your <strong>Dashboard</strong></li>
          <li>Click on <strong>‚ÄúCreate API Key‚Äù</strong> and give it a name</li>
          <li>Copy the key and paste it in the ‚ÄúAPI KEY‚Äù field</li>
        </ol>
        <p>
          ‚ö° <strong>Free Tier:</strong> 250 req/min, 200k/day<br />
          üìÑ <a href="https://docs.helius.xyz/" target="_blank" style="color:#4fc3f7">Read Helius API Docs</a>
        </p>


        <hr style="margin: 30px 0; border: 1px solid #555;" />

        <p style="font-size: 16px; line-height: 1.6;">
          ‚ö†Ô∏è Rate limits may apply depending on your tier or usage.<br />
          You can upgrade your plans on each explorer site for higher throughput if needed.
        </p>
    </div>

    <footer style="font-size: 12px; color: #888; text-align: center; border-top: 1px solid #333; padding-top: 10px;">
      &copy; naamahdaemon ‚Äì <a href="https://mina.naamahdaemon.eu" target="_blank" style="color: #4fc3f7; text-decoration: none;">mina.naamahdaemon.eu</a><br/>
      Minataur API by <a href="https://minataur.net/api/restful" target="_blank" style="color: #4fc3f7; text-decoration: none;">minataur.net</a> - 
      Tezos API by <a href="https://api.tzkt.io/#section/Get-Started/Free-TzKT-API" target="_blank" style="color: #4fc3f7; text-decoration: none;">TzKt</a> - 
      Other API by <a href="https://www.alchemy.com/" target="_blank" style="color: #4fc3f7; text-decoration: none;">Alchemy</a>
    </footer>  
  



  <button id="exit-fullscreen-btn" style="
    display: none;
    position: fixed;
    top: 20px;
    right: 30px;
    z-index: 99;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 6px;
    cursor: pointer;
  ">
    ‚õ∂ Exit Fullscreen
  </button>  
  
<div id="legend" class="legend-box" style="left: 330px; cursor: move; user-select: none; touch-action: none;">
  <!-- Command Types (Foldable) -->
  <div class="legend-section">
    <div class="legend-toggle" data-target="#command-types" style="cursor:pointer;"><em>‚ñ∂ Command Types</em></div>
    <div id="command-types" style="display: none;">
    <div class="legend-item" data-command-type="payment" style="color:#4caf50; cursor:pointer;">‚óè Payment</div>
    <div class="legend-item" data-command-type="delegation" style="color:#2196f3; cursor:pointer;">‚óè Delegation</div>
    <div class="legend-item" data-command-type="zkapp" style="color:#9c27b0; cursor:pointer;">‚óè Contracts</div>
    <div class="legend-item" data-command-type="token_transfer" style="color:#f9a825; cursor:pointer;">‚óè Token</div>
    </div>
  </div>

  <hr style="margin: 8px 0;">

  <!-- Blockchain Types (Foldable) -->
  <div class="legend-section">
    <div class="legend-toggle" data-target="#blockchain-types" style="cursor:pointer;"><em>‚ñ∂ Blockchain</em></div>
    <div id="blockchain-types" style="display: none;">
      <div class="legend-chain" data-chain="mina" style="color:#009688;">‚óè Mina</div>
      <div class="legend-chain" data-chain="ethereum" style="color:#627eea;">‚óè Ethereum</div>
      <div class="legend-chain" data-chain="polygon" style="color:#8247e5;">‚óè Polygon</div>
      <div class="legend-chain" data-chain="bsc" style="color:#f0b90b;">‚óè BSC</div>
      <div class="legend-chain" data-chain="solana" style="color:#9945FF;">‚óè Solana</div>
      <div class="legend-chain" data-chain="zksync" style="color:#ff4081;">‚óè zkSync</div>
      <div class="legend-chain" data-chain="optimism" style="color:#ff6d00;">‚óè Optimism</div>
      <div class="legend-chain" data-chain="arbitrum" style="color:#00bcd4;">‚óè Arbitrum</div>
      <div class="legend-chain" data-chain="cronos" style="color:#d42727;">‚óè Cronos</div>
      <div class="legend-chain" data-chain="tezos" style="color:#2c7df7;">‚óè Tezos</div>
      <div class="legend-chain" data-chain="base" style="color:#2c7df7;">‚óè Base</div>
    </div>
  </div>

  <hr style="margin: 8px 0;">  

  <!-- Reset -->
    <div class="legend-item" data-command-type="" style="color:#aaa; cursor:pointer; margin-top: 6px;">‚úñ Reset</div>
  </div>
  
  <script type="module">
    import bs58 from 'https://cdn.skypack.dev/bs58';

    function encodeMemoToBase58(memo) {
      const bytes = new TextEncoder().encode(memo);
      return bs58.encode(bytes);
    }

    // Make function globally available if needed
    window.encodeMemoToBase58 = encodeMemoToBase58;
  </script>

  <div id="loader-modal" style="
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    flex-direction: column;
    font-family: monospace;
    padding: 20px;
  ">
  
  
    <h2 style="margin-bottom: 20px;">Fetching graph data...</h2>
    <pre id="loader-log" style="
      background: #111;
      padding: 15px;
      border-radius: 6px;
      max-height: 250px;
      overflow-y: auto;
      width: 400px;
      font-size: 13px;
    "></pre>
    <button id="stop-loading-btn" style="
      margin-top: 20px;
      padding: 10px 20px;
      background: #f44336;
      border: none;
      border-radius: 4px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    ">Stop</button>    
  </div>
 <div id="error-popup" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1e1e1e;
  color: white;
  padding: 30px 40px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.6);
  z-index: 10001;
  font-family: 'Coda', sans-serif;
  text-align: center;
  max-width: 80%;
">
  <p id="error-message" style="margin-bottom: 20px; font-size: 16px;">Something went wrong with the API.</p>
  <button onclick="document.getElementById('error-popup').style.display='none'" style="
    background: #f44336;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 4px;
  ">Close</button>
</div>  

<div id="splash-screen">
  <div class="splash-content">
    <img src="./icons/icon-512.png" alt="MinaGraph" />
    <h1>Mina Graph Explorer</h1>
  </div>
</div>

<div id="network-status" style="
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 12px;
  z-index: 9999;
  display: none;">
  Offline mode
</div>

<div id="overlay-spinner" class="overlay-hidden">
  <div class="overlay-box">
    <div id="overlay-message">Fetching...</div><br/>
    <div class="css-spinner"></div>
  </div>
</div>

<div id="qrcode-modal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:10000; align-items:center; justify-content:center;">
  <div style="background:#fff; padding:20px; border-radius:10px; text-align:center; position:relative;">
    <div id="qrcode-container"></div><br/>
    <button onclick="document.getElementById('qrcode-modal').style.display='none'" 
      style="
          padding: 4px 10px;
          font-size: 10px;
          background: #e53935;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
      ">
      Close
    </button>
  </div>
</div>

  <div id="toast" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    padding: 10px 14px;
    border-radius: 6px;
    font-size: 14px;
    display: none;
    z-index: 1000;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    max-width: 300px;
    line-height: 1.4;
  "></div>

</body>
</html>